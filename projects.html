<!-- projects.html (directory v4) -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Projects — Dominic Vicchiollo</title>
  <meta name="description" content="Projects and case studies by Dominic Vicchiollo." />
  <link rel="canonical" href="./projects.html" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <!-- highlight.js for SQL display -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>

  <style>
    :root{
      --bg:#0b1020;
      --surface:#0f1630;
      --card:#121a31;
      --border:#1c2442;
      --muted:#a7b0c0;
      --text:#e9eef8;
      --accent:#7c9cff;
      --accent-2:#22d3ee;
      --radius:18px;
      --shadow:0 24px 80px rgba(0,0,0,.45);
      --container:1600px;
    }
    html,body{background:var(--bg); color:var(--text); font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol"; margin:0;}
    a{color:inherit}
    .container{max-width:var(--container); margin:0 auto; padding:0 24px;}
    .page-hero{padding:48px 0 18px;}
    .page-title{font-family:"Space Grotesk", Inter, sans-serif; font-size:clamp(32px,4vw,56px); margin:0 0 10px;}
    .page-kicker{color:var(--muted); max-width:70ch; margin:0;}
    /* app layout */
    .app{padding:12px 0 32px;}
    .app-layout{display:grid; grid-template-columns: 340px 1fr; gap:22px; align-items:start;}
    @media (max-width: 1100px){ .app-layout{ grid-template-columns: 1fr; } }

    /* left directory */
    .directory{position:sticky; top:16px; align-self:start; max-height:calc(100vh - 32px);}
    .dir-card{background:var(--card); border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow); display:flex; flex-direction:column; overflow:hidden; height:100%;}
    .dir-head{padding:12px 14px; border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between;}
    .dir-title{font-weight:700; letter-spacing:.02em;}
    .dir-body{overflow:auto;}
    .tree{padding:6px;}
    .tree details{border:1px solid var(--border); border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0)); margin:6px 6px 10px;}
    .tree summary{list-style:none; cursor:pointer; padding:10px 12px; display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .tree summary::-webkit-details-marker{display:none}
    .caret{width:18px; height:18px; display:inline-grid; place-items:center; border:1px solid var(--border); border-radius:6px; background:rgba(255,255,255,.02);}
    details[open] .caret{transform:rotate(90deg)}
    .tree-count{color:var(--muted); font-size:.85rem;}
    .group{padding:6px 8px 12px;}
    .node{border:1px dashed var(--border); border-radius:10px; margin:8px; background:rgba(255,255,255,.01);}
    .node summary{padding:8px 10px;}
    .dir-list{list-style:none; margin:0; padding:6px;}
    .dir-item{margin:0; padding:0;}
    .tree-item{width:100%; text-align:left; background:transparent; color:var(--text); border:1px solid transparent; padding:8px 10px; border-radius:10px; cursor:pointer; display:flex; align-items:center; gap:8px;}
    .tree-item:hover{background:rgba(255,255,255,.05); border-color:var(--border);}
    .tree-item.active{background:rgba(124,156,255,.18); border-color: rgba(124,156,255,.55);}
    .bullet{width:6px; height:6px; border-radius:999px; background:var(--accent-2); opacity:.9;}

    /* right workspace (split: content + details) */
    .workspace{display:grid; grid-template-columns: minmax(620px, 1fr) 1fr; gap:18px; min-height:60vh;}
    @media (max-width:1200px){ .workspace{ grid-template-columns: 1fr; } }
    .workbench{height:calc(100vh - 170px); min-height:540px; background: var(--card); border:1px solid var(--border); border-radius:18px; overflow:hidden; display:flex; flex-direction:column;}
    @media (max-width:1100px){ .workbench{ height: 60vh; } }
    .wb-tabs{display:flex; gap:8px; padding:10px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.0)); position:sticky; top:0; z-index:2;}
    .tab{padding:.45rem .8rem; border-radius:999px; border:1px solid var(--border); background:transparent; cursor:pointer; font-weight:600;}
    .tab[aria-selected="true"]{ background: rgba(124,156,255,.18); border-color: rgba(124,156,255,.55); }
    .wb-stage{position:relative; flex:1; overflow:auto; background:#0c0f1e;}
    .wb-stage iframe{border:0; width:100%; height:100%;}
    pre.code{margin:0; padding:18px; min-height:100%; font-size:.95rem;}

    .details{display:grid; gap:14px; align-content:start;}
    .kicker{color:var(--muted); margin:0;}
    .title{font-family:"Space Grotesk"; font-size:clamp(28px,3vw,40px); margin:.1rem 0;}
    .subtitle{color:#cfd6e6; font-weight:500; margin:0;}
    .desc{color:#dfe5f3; line-height:1.6; margin:.5rem 0 0;}
    .info-grid{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    .info-card{border:1px solid var(--border); background:var(--card); border-radius:14px; padding:10px 12px;}
    .info-title{color:var(--muted); font-size:.85rem; margin:0 0 6px;}
    .pill-row{display:flex; flex-wrap:wrap; gap:.4rem;}
    .pill{font-size:.8rem; padding:.25rem .6rem; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.02);}
    .highlights{margin:4px 0 0; padding-left:1.1rem;}
    .metrics{display:grid; grid-template-columns: repeat(auto-fill, minmax(160px,1fr)); gap:10px;}
    .metric{border:1px solid var(--border); background:var(--card); border-radius:12px; padding:.6rem .7rem;}
    .metric-label{color:var(--muted); font-size:.85rem; margin:0;}
    .metric-value{font-weight:700; font-size:1.05rem; margin-top:.15rem;}
    .links{display:flex; gap:.6rem; flex-wrap:wrap; margin-top:.2rem;}
    .btn{padding:.55rem .8rem; border-radius:10px; border:1px solid var(--border); background:rgba(255,255,255,.04); color:var(--text); cursor:pointer;}
    .btn.ghost{background:transparent;}
  </style>
</head>
<body>
  <!-- Site header + nav -->
  <header class="site-header" data-parallax>
    <div class="container header-inner">
      <a class="brand" href="index.html" aria-label="Home">
        <span class="brand-mark">DV</span>
        <span class="brand-text">Dominic Vicchiollo</span>
      </a>

      <button class="nav-toggle" aria-controls="site-nav" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>

      <nav id="site-nav" class="site-nav" aria-label="Primary">
        <a href="index.html" class="nav-link">Home</a>
        <a href="projects.html" class="nav-link is-active">Projects</a>
        <a href="domguardianai.html" class="nav-link">DomGuardianAI</a>
      </nav>
    </div>

    <!-- Page heading -->
    <div class="container page-hero">
      <h1 class="page-title">Projects</h1>
      <p class="page-kicker">A modern navigator: select from the directory on the left; view PDFs & SQL with rich details on the right.</p>
    </div>
  </header>

  <main class="app">
    <div class="container app-layout">
      <!-- Directory (left) -->
      <aside class="directory">
        <div class="dir-card">
          <div class="dir-head">
            <span class="dir-title">Directory</span>
          </div>
          <div class="dir-body">
            <div id="dir-tree" class="tree"></div>
          </div>
        </div>
      </aside>

      <!-- Workspace (right) -->
      <section class="workspace">
        <div class="workbench">
          <div class="wb-tabs" id="wb-tabs"></div>
          <div class="wb-stage" id="wb-stage"><!-- PDF/SQL appear here --></div>
        </div>

        <div class="details">
          <p id="detail-kicker" class="kicker"></p>
          <h2 id="detail-title" class="title"></h2>
          <p id="detail-sub" class="subtitle"></p>
          <p id="detail-desc" class="desc"></p>

          <div class="info-grid">
            <div class="info-card">
              <p class="info-title">Role</p>
              <div id="d-role" class="pill-row"></div>
            </div>
            <div class="info-card">
              <p class="info-title">Tech</p>
              <div id="d-tech" class="pill-row"></div>
            </div>
            <div class="info-card">
              <p class="info-title">Tags</p>
              <div id="d-tags" class="pill-row"></div>
            </div>
            <div class="info-card">
              <p class="info-title">Actions</p>
              <div id="d-links" class="links"></div>
            </div>
          </div>

          <div>
            <p class="info-title" style="margin:.2rem 0 .4rem;">Highlights</p>
            <ul id="d-highlights" class="highlights"></ul>
          </div>

          <div>
            <p class="info-title" style="margin:.2rem 0 .4rem;">Metrics</p>
            <div id="d-metrics" class="metrics"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <p>© <span id="year"></span> Dominic Vicchiollo</p>
      <div class="social">
        <a href="https://github.com/domvicc" target="_blank" rel="noopener">GitHub</a>
        <a href="https://www.linkedin.com/in/dominicvicchiollo" target="_blank" rel="noopener">LinkedIn</a>
        <a href="mailto:dvicchiollo@gmail.com">Email</a>
      </div>
    </div>
  </footer>

  <!-- Embedded projects data -->
  <script type="application/json" id="projects-data">
  [
    {
      "id": "inventory-audit-journal",
      "title": "Inventory Audit Journal",
      "subtitle": "Reconciling perpetual vs G/L with staged audit layers",
      "description": "Large scripted job creating staging and analysis tables to reconcile perpetual vs G/L, rebate variance, and SPA claim health with repeatable indexes and branching filters.",
      "cover": [{"src":"assets/img/inventory_audit_cover.jpg","alt":"Inventory Audit"}],
      "tags": ["SQL Development","Audit","Inventory"],
      "tech_stack": ["T-SQL","SQL Agent","Indexing"],
      "role": "Data Engineer",
      "links": {
        "repo":"sql/inventory_audit.sql",
        "case_study":"assets/pdfjs/web/viewer.html?file=../../pdf/inventory_audit_notes.pdf"
      },
      "metrics": [{"label":"Tables","value":"12"},{"label":"Indexes","value":"27"},{"label":"Runtime","value":"< 6m"}],
      "highlights": ["Branching filter paths","Repeatable index strategy","Variance surfacing for Ops"],
      "featured": true
    },
    {
      "id": "product-365-sales",
      "title": "365-Day Product Sales",
      "subtitle": "Rolling 30/90/365 movement and cost for turns",
      "description": "Aggregates rolling movement and cost to feed excess/turns KPIs while isolating returns and enforcing location-type rules.",
      "cover": [{"src":"assets/img/365_sales.jpg","alt":"Sales Coverage"}],
      "tags": ["SQL Development","KPIs","Performance"],
      "tech_stack": ["T-SQL","Window Functions"],
      "role": "Data Engineer",
      "links": {"repo":"sql/product_365_sales.sql"},
      "metrics": [{"label":"Rows/day","value":"40M+"},{"label":"Refresh","value":"Hourly"}],
      "highlights": ["Window functions","Return isolation","Location rules"],
      "featured": true
    },
    {
      "id": "price-matrix-replacement-cost",
      "title": "Price Matrix & Replacement Cost",
      "subtitle": "Unified cost sources and tier logic",
      "description": "Supporting scripts unify cost sources and tier logic to drive margin analytics and downstream contract pricing.",
      "cover": [{"src":"assets/img/price_matrix.jpg","alt":"Price Matrix"}],
      "tags": ["SQL Development","Costing","Margin"],
      "tech_stack": ["T-SQL","ETL"],
      "role": "Data Engineer",
      "links": {"repo":"sql/price_matrix.sql"},
      "metrics": [{"label":"Tiers","value":"7"},{"label":"Latency","value":"< 2m"}],
      "highlights": ["Tier precedence","Margin analytics","Contract pricing feed"],
      "featured": false
    },
    {
      "id": "branch-ledger-feeds",
      "title": "Branch & Ledger Feeds",
      "subtitle": "Dimensions and facts for BI & Finance",
      "description": "Core dimension and fact extracts shaping a governed layer for Power BI and finance reconciliation (A/R, A/P, Inventory).",
      "cover": [{"src":"assets/img/ledger.jpg","alt":"Ledger Feeds"}],
      "tags": ["SQL Development","Operations","Governance"],
      "tech_stack": ["T-SQL","Power BI"],
      "role": "Data Engineer",
      "links": {"repo":"sql/ledger_file.sql"},
      "metrics": [{"label":"Dimensions","value":"12"},{"label":"Facts","value":"9"}],
      "highlights": ["Shared dimensions","BI-ready facts","Recon alignment"],
      "featured": false
    },
    {
      "id": "branch-inventory-foundation",
      "title": "Branch Inventory Foundation",
      "subtitle": "Surrogate keys and indexed attributes",
      "description": "Consolidates product and branch calculation sources; indexes lead time and safety stock attributes for availability and aging analytics.",
      "cover": [{"src":"assets/img/inventory_foundation.jpg","alt":"Inventory Foundation"}],
      "tags": ["SQL Development","Inventory","Performance"],
      "tech_stack": ["T-SQL","Indexing"],
      "role": "Data Engineer",
      "links": {"repo":"sql/product_branch_inventory.sql"},
      "metrics": [{"label":"SLO","value":"p95 < 1.2s"},{"label":"Size","value":"200 GB"}],
      "highlights": ["Consolidated keys","Availability analytics","Aging insights"],
      "featured": false
    },
    {
      "id": "spa-rebate-normalization",
      "title": "SPA & Rebate Normalization",
      "subtitle": "Clean fact for margin reconciliation",
      "description": "Extracts PO and sales linkages, classifies SPA vs SPJ, and materializes a clean rebate fact for variance and eligibility.",
      "cover": [{"src":"assets/img/rebates.jpg","alt":"Rebate Normalization"}],
      "tags": ["SQL Development","Rebates","Margin"],
      "tech_stack": ["T-SQL","Joins"],
      "role": "Data Engineer",
      "links": {"repo":"sql/rebates.sql"},
      "metrics": [{"label":"Link accuracy","value":"99.2%"},{"label":"Records","value":"35M"}],
      "highlights": ["SPA/SPJ classification","Variance surfacing","Eligibility flags"],
      "featured": false
    },
    {
      "id": "tagged-order-variance",
      "title": "Tagged Order Variance",
      "subtitle": "Reconcile sales lines to PO/transfer tags",
      "description": "Reconciles sales lines to PO and transfer tags, flags cost variances, and surfaces broken tag scenarios for correction.",
      "cover": [{"src":"assets/img/tagged_orders.jpg","alt":"Tagged Orders"}],
      "tags": ["SQL Development","Audit","Exceptions"],
      "tech_stack": ["T-SQL"],
      "role": "Data Engineer",
      "links": {"repo":"sql/so_tagged_orders.sql"},
      "metrics": [{"label":"Exceptions/day","value":"~2k"},{"label":"MTTR","value":"< 1d"}],
      "highlights": ["Variance detection","Exception queues","Ops handoff"],
      "featured": false
    },
    {
      "id": "unbilled-ap-exposure",
      "title": "Unbilled AP Exposure",
      "subtitle": "Accrual and payment G/L to UBAP",
      "description": "Produces an unbilled payable ledger combining accrual and payment G/L postings to monitor aging and exceptions before liability surprises.",
      "cover": [{"src":"assets/img/unbilled_ap.jpg","alt":"Unbilled AP"}],
      "tags": ["Finance","Controls","AP"],
      "tech_stack": ["T-SQL"],
      "role": "Data Engineer",
      "links": {"repo":"sql/ap_unbilled.sql"},
      "metrics": [{"label":"Exposure delta","value":"−18%"},{"label":"Alerts","value":"Daily"}],
      "highlights": ["Aging visibility","Pre-invoice signals","Finance alignment"],
      "featured": false
    },
    {
      "id": "covid-workforce-planning",
      "title": "COVID-19 Workforce Planning & Reporting",
      "subtitle": "Productivity vs. hours to inform staffing",
      "description": "Executive dashboard measuring productivity against working hours to manage workforce utilization during the pandemic; contributed to zero layoffs.",
      "cover": [{"src":"assets/img/workforce.jpg","alt":"Workforce Planning"}],
      "tags": ["Operations","Case Study","Power BI","Analytics"],
      "tech_stack": ["SQL","Power BI","SSMS"],
      "role": "Analytics Engineer",
      "links": {"case_study":"assets/pdfjs/web/viewer.html?file=../../pdf/operational_productivity.pdf"},
      "metrics": [{"label":"Teams","value":"6"},{"label":"Dashboards","value":"4"}],
      "highlights": ["Exec-ready visuals","Utilization insights","Schedule optimization"],
      "featured": true
    },
    {
      "id": "lakehouse-synapse-strategy",
      "title": "Lakehouse & Synapse Strategy",
      "subtitle": "ADLS Gen2 + Synapse (serverless/dedicated)",
      "description": "Azure-first lake design with governed zones and shared definitions for BI; cost-aware and reliable.",
      "cover": [{"src":"assets/img/lakehouse.jpg","alt":"Lakehouse"}],
      "tags": ["Architecture","Platform","Governance"],
      "tech_stack": ["ADLS Gen2","Synapse","RBAC/RLS"],
      "role": "Architect",
      "links": {},
      "metrics": [{"label":"Zones","value":"3"},{"label":"Cost ↓","value":"~22%"}],
      "highlights": ["Zone governance","Shared dimensions","Cost control"],
      "featured": false
    },
    {
      "id": "minwage-compliance-dashboard",
      "title": "Minimum Wage Compliance Dashboard",
      "subtitle": "Blending BLS CPI with multi-level wage rules",
      "description": "Power BI dashboard with ratio trends and alerts across federal/state/county/city minimum-wage rules.",
      "cover": [{"src":"assets/img/minwage.jpg","alt":"Minimum Wage Dashboard"}],
      "tags": ["Compliance","Research","Analytics"],
      "tech_stack": ["Power BI","Azure","Python"],
      "role": "Analytics Engineer",
      "links": {},
      "metrics": [{"label":"Jurisdictions","value":"500+"},{"label":"Alert latency","value":"< 1 day"}],
      "highlights": ["CPI overlays","Multi-level rules","Alerting"],
      "featured": true
    }
  ]
  </script>

  <!-- App script: build directory and wire right-hand workspace -->
  <script>
(() => {
  const $ = (s, r=document) => r.querySelector(s);
  const $$ = (s, r=document) => [...r.querySelectorAll(s)];
  const byId = id => document.getElementById(id);

  // load data
  let projects = [];
  try { projects = JSON.parse(byId('projects-data').textContent.trim()); }
  catch (e) { console.error('Invalid JSON in #projects-data', e); return; }

  // elements
  const tree = byId('dir-tree');
  const tabs = byId('wb-tabs');
  const stage = byId('wb-stage');
  const els = {
    kicker: byId('detail-kicker'),
    title: byId('detail-title'),
    sub: byId('detail-sub'),
    desc: byId('detail-desc'),
    role: byId('d-role'),
    tech: byId('d-tech'),
    tags: byId('d-tags'),
    highlights: byId('d-highlights'),
    metrics: byId('d-metrics'),
    links: byId('d-links'),
  };

  // helpers
  const keyify = s => String(s||'').trim().toLowerCase();
  const sortByTitle = arr => arr.slice().sort((a,b)=>a.title.localeCompare(b.title));

  // Build directory structure
  buildDirectory();

  function buildDirectory(){
    tree.innerHTML = '';

    // All Projects
    tree.appendChild(sectionNode('All Projects', projects.length, listNode(sortByTitle(projects))));

    // Tags -> each tag group
    const tagMap = new Map();
    projects.forEach(p => (p.tags||[]).forEach(t => {
      if (!tagMap.has(t)) tagMap.set(t, []);
      tagMap.get(t).push(p);
    }));
    const tagsWrap = document.createElement('div'); tagsWrap.className = 'group';
    [...tagMap.entries()].sort((a,b)=>a[0].localeCompare(b[0])).forEach(([tag, arr]) => {
      tagsWrap.appendChild(sectionNode(tag, arr.length, listNode(sortByTitle(arr)), 'node'));
    });
    tree.appendChild(sectionNode('Tags', tagMap.size, tagsWrap));

    // Tech -> each tech group
    const techMap = new Map();
    projects.forEach(p => (p.tech_stack||[]).forEach(t => {
      if (!techMap.has(t)) techMap.set(t, []);
      techMap.get(t).push(p);
    }));
    const techWrap = document.createElement('div'); techWrap.className = 'group';
    [...techMap.entries()].sort((a,b)=>a[0].localeCompare(b[0])).forEach(([tech, arr]) => {
      techWrap.appendChild(sectionNode(tech, arr.length, listNode(sortByTitle(arr)), 'node'));
    });
    tree.appendChild(sectionNode('Tech', techMap.size, techWrap));

    // Activate first item by default
    const firstBtn = tree.querySelector('.dir-list .tree-item');
    if (firstBtn) firstBtn.click();
  }

  function sectionNode(label, count, childContent, cls=''){
    const det = document.createElement('details');
    det.className = cls ? 'tree-node '+cls : 'tree-node';
    det.open = true;
    const sum = document.createElement('summary');
    sum.innerHTML = '<span>'+label+'</span><span class="tree-count">'+count+'</span>';
    const caret = document.createElement('span'); caret.className='caret'; caret.textContent='›';
    sum.prepend(caret);
    det.appendChild(sum);
    if (childContent) det.appendChild(childContent);
    return det;
  }

  function listNode(items){
    const ul = document.createElement('ul'); ul.className='dir-list';
    items.forEach(p => {
      const li = document.createElement('li'); li.className='dir-item';
      const btn = document.createElement('button'); btn.className='tree-item'; btn.dataset.id=p.id;
      btn.innerHTML = '<span class="bullet"></span><span>'+p.title+'</span>';
      btn.addEventListener('click', () => selectProject(p.id, btn));
      li.appendChild(btn); ul.appendChild(li);
    });
    return ul;
  }

  function selectProject(id, btn){
    // active state
    $$('.tree-item').forEach(b => b.classList.toggle('active', b === btn));
    const p = projects.find(x => x.id === id);
    if (!p) return;
    openProject(p);
  }

  function openProject(p){
    // right column details
    els.kicker.textContent = (p.tags||[]).slice(0,1).join(' • ');
    els.title.textContent = p.title;
    els.sub.textContent = p.subtitle || '';
    els.desc.textContent = p.description || '';
    els.role.innerHTML = ''; if (p.role) els.role.appendChild(pill(p.role));
    els.tech.innerHTML = ''; (p.tech_stack||[]).forEach(t => els.tech.appendChild(pill(t)));
    els.tags.innerHTML = ''; (p.tags||[]).forEach(t => els.tags.appendChild(pill(t)));
    els.highlights.innerHTML = ''; (p.highlights||[]).forEach(hh => els.highlights.appendChild(li(hh)));
    els.metrics.innerHTML = ''; (p.metrics||[]).forEach(m => els.metrics.appendChild(metric(m.label, m.value)));
    els.links.innerHTML = '';
    if (p.links?.demo) els.links.appendChild(linkBtn('Open demo', p.links.demo));
    if (p.links?.repo) els.links.appendChild(linkBtn('Open repo', p.links.repo));
    if (p.links?.case_study) els.links.appendChild(linkBtn('Open PDF', p.links.case_study));

    // workbench tabs/stage
    tabs.innerHTML=''; stage.innerHTML='';
    const tb = [];
    if (p.links?.case_study) tb.push({id:'pdf', label:'PDF'});
    if (p.links?.repo) tb.push({id:'sql', label:'SQL'});
    if (!tb.length) tb.push({id:'cover', label:'Preview'});
    tb.forEach((t,i)=>{
      const b = document.createElement('button'); b.className='tab'; b.textContent=t.label; b.dataset.id=t.id;
      b.setAttribute('aria-selected', i===0 ? 'true' : 'false');
      b.addEventListener('click',()=>setTab(t.id,p));
      tabs.appendChild(b);
    });
    setTab(tb[0].id,p);
  }

  function setTab(id, p){
    $$('#wb-tabs .tab').forEach(b => b.setAttribute('aria-selected', b.dataset.id === id ? 'true' : 'false'));
    stage.innerHTML = '';
    if (id === 'pdf' && p.links?.case_study){
      const frame = document.createElement('iframe');
      frame.src = p.links.case_study;
      stage.appendChild(frame);
    } else if (id === 'sql' && p.links?.repo){
      const pre = document.createElement('pre'); pre.className = 'code';
      const code = document.createElement('code'); code.className = 'language-sql'; code.textContent = 'Loading SQL…';
      pre.appendChild(code); stage.appendChild(pre);
      fetch(p.links.repo, {cache:'no-store'}).then(r => r.ok ? r.text() : Promise.reject(r.status)).then(txt => {
        code.textContent = txt; if (window.hljs) window.hljs.highlightElement(code);
      }).catch(()=>{ code.textContent = 'Could not load SQL file. Use "Open repo" to view it.'; });
    } else {
      const img = document.createElement('img');
      img.alt = p?.cover?.[0]?.alt || p.title;
      img.src = p?.cover?.[0]?.src || 'assets/img/placeholder.jpg';
      img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover';
      stage.appendChild(img);
    }
  }

  // tiny builders
  function pill(text){ const s=document.createElement('span'); s.className='pill'; s.textContent=text; return s; }
  function li(text){ const n=document.createElement('li'); n.textContent=text; return n; }
  function metric(label, value){ const c=document.createElement('div'); c.className='metric'; const l=document.createElement('p'); l.className='metric-label'; l.textContent=label; const v=document.createElement('p'); v.className='metric-value'; v.textContent=value; c.append(l,v); return c; }
  function linkBtn(label, href){ const a=document.createElement('a'); a.className='btn ghost'; a.target='_blank'; a.rel='noopener'; a.href=href; a.textContent=label; return a; }

  // footer year
  const y = byId('year'); if (y) y.textContent = new Date().getFullYear();
  if (window.hljs) window.hljs.highlightAll?.();
})();
  </script>
</body>
</html>
